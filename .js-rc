#!/usr/bin/env bash

# Node helpers
export jsh="$(dirname "${BASH_SOURCE[0]}")/js-helpers"

export PATH="$PATH:$HOME/node_modules/.bin"
export PATH="$PATH:node_modules/.bin"

if which brew &> /dev/null; then
  export NVM_DIR=~/.nvm
  nvm_dir="$(brew --prefix nvm)"
  if [ -d "$nvm_dir" ]; then
    . "$nvm_dir/nvm.sh"
  fi
fi

defn nr npm run

defn ppj pretty-print-json
defn pjl pretty-print-json-less
defn jql pretty-print-json-less

defn jf jq -f
defn jqf jq -f
defn jr jq -r
defn jqr jq -r
defn jqc jq -c
defn jqn jq length
jq_keys() {
    jq -r 'keys[]' "$@"
}
export -f jq_keys
defn jqk jq_keys

defn nrb npm run build
defn nrd npm run dev
defn nrdk npm run docker
defn nrx npm run export

defn nxd next dev
defn nb next build
defn nxb next build
defn nx next export
defn nxx next export
next_build_export() {
    next build && next export "$@"
}
export -f next_build_export
defn nbx next_build_export
defn nxbx next_build_export

declare_module() {
    m="$1"; shift
    d="node_modules/@types/$m"
    mkdir -p "$d"
    echo "declare module '$m';" > "$d/index.d.ts"
}
export -f declare_module
defn dm declare_module

defn p2j parquet2json
defn p2js parquet-2-json.sh schema
defn p2jn parquet-2-json.sh rowcount
defn p2jc parquet-2-json.sh cat

defn y yarn
defn yb yarn build
defn yi yarn install
